{
  "_meta": { "status": 0 },
  "id": "_plan2",
  "name": "Response Plan for Earthquake 2 (demo)",
  "description": "A workflow for staff members in case of earthquake.",
  "testTrigger": "http://localhost:9000/api/nrf/trigger/panicbutton",
  "phases": [
    {
      "name": "Preparation",
      "trigger": {
        "name": null,
        "subscribeTo": { "endpoint": null, "params": {} }
      },
      "blocks": []
    },
    {
      "name": "Immediately After",
      "trigger": {
        "name": "Alarm Events",
        "subscribeTo": {
          "id": "eew",
          "version": 1,
          "name": "Earthquake Early Warning",
          "style": "is-danger",
          "always": false,
          "message": "An earthquake with a magnitude over 6.0 hits the current location",
          "endpoint": "/nrf/trigger/panicbutton",
          "params": { "magnitude": 6 }
        }
      },
      "complete": {
        "name": null,
        "invoke": {
          "endpoint": "/nrf/checkpoint/complete",
          "params": { "phaseId": "_plan1-1" },
          "output": []
        }
      },
      "blocks": [
        {
          "id": "anpi",
          "name": "Respond Personal Safety Confirmation",
          "style": "",
          "category": ["Action"],
          "always": false,
          "message": "",
          "endpoint": "/nrf/action/message",
          "params": {
            "title": "Personal Safety Confirmation",
            "content": "",
            "choices": [
              {
                "text": "I'm Safe",
                "action": {
                  "endpointInternal": "api/feed",
                  "params": { "content": "Confirmed safety" }
                },
                "close": true
              },
              {
                "text": "I'm in Trouble",
                "action": {
                  "endpointInternal": "api/feed",
                  "params": { "content": "Reported trouble" }
                },
                "close": true
              }
            ]
          },
          "output": [
            {
              "name": "Mobile client (demo)",
              "endpoint": "/nrf/output/demo_client"
            }
          ]
        }
      ]
    },
    {
      "name": "Before Evacuation",
      "trigger": {
        "name": null,
        "subscribeTo": {
          "endpoint": "/nrf/checkpoint/complete",
          "params": { "phaseId": "_plan1-1" }
        }
      },
      "blocks": []
    },
    {
      "name": "Evacuation",
      "trigger": {
        "name": "Checkpoint",
        "subscribeTo": {
          "name": "Evacuation Order",
          "message": "Evacuation order by administrative staff members",
          "style": "is-info",
          "endpoint": "/nrf/checkpoint/pressbutton",
          "params": {}
        }
      },
      "complete": null,
      "blocks": []
    },
    {
      "name": "Stay at Evacuation Site",
      "trigger": {
        "name": "Checkpoint",
        "subscribeTo": {
          "name": "Arrived to Evacuation Site",
          "message": "",
          "style": "is-info",
          "endpoint": "/nrf/checkpoint/location_based_checkpoint",
          "params": {}
        }
      },
      "complete": { "name": "Checkpoint: Confirm Flow End" },
      "blocks": []
    }
  ]
}
